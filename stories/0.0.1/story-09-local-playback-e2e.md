# Story 09：本地播放端到端

## 目标
打通本地文件播放的完整链路：load→play/pause/seek→波形/频谱更新，时间同步以音频时钟为准（TDD）。

## 测试优先（TDD）
- ✔ [1] 先编写集成测试：本地文件播放，play/pause/seek 同步误差 < 50 ms。
- ✔ [2] 错误用例：不存在文件/格式不支持触发正确提示。
- ✔ [3] 性能 smoke：短音频循环无崩溃/无漂移。

## 开发任务
- ✔ [4] 插件和 C/C++ 核心全链路连通：FFmpeg 解码 → RingBuffer → PlaybackThread/平台回放，PCM/频谱旁路节流，seek 时清空缓冲并重置时钟对齐。
- ✔ [5] 状态事件完备并映射到 Dart：准备/播放/暂停/结束/错误；错误码覆盖文件不存在/格式不支持/IO/解码错误，EOF 事件明确。
- ✔ [6] 波形/频谱组件接入真实数据，刷新以音频时钟为基准，避免 UI 时间基漂移。

## 完成标准（DoD）
- ✔ [7] 集成测试/错误用例/性能 smoke 均通过。
